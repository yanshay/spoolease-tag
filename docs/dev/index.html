<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Development page</title>
  </head>
  <body>
    <h1>Development Page</h1>

    <script>
      function openDB() {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open("SpoolEaseDB", 1);
          request.onerror = () => reject(request.error);
          request.onsuccess = () => resolve(request.result);
          request.onupgradeneeded = (e) => {
            const db = e.target.result;
            if (!db.objectStoreNames.contains("settings")) {
              db.createObjectStore("settings", { keyPath: "key" });
            }
          };
        });
      }

      async function getDBValue(key) {
        const db = await openDB();
        return new Promise((resolve, reject) => {
          const tx = db.transaction("settings", "readonly");
          const store = tx.objectStore("settings");
          const request = store.get(key);
          request.onsuccess = () =>
            resolve(request.result ? request.result.value : "");
          request.onerror = () => reject(request.error);
        });
      }

      async function setDBValue(key, value) {
        const db = await openDB();
        return new Promise((resolve, reject) => {
          const tx = db.transaction("settings", "readwrite");
          const store = tx.objectStore("settings");
          const request = store.put({ key, value });
          request.onsuccess = () => resolve();
          request.onerror = () => reject(request.error);
        });
      }
      (async () => {
        const params = new URLSearchParams(window.location.search);
        const stop = params.get("stop");
        if (!stop) {
          await setDBValue("devHostname", "192.168.10.51");
          await setDBValue("devPort", "5173");
          await setDBValue("devProtocol", "http:");
        } else {
          await setDBValue("devHostname", "");
          await setDBValue("devPort", "");
          await setDBValue("devProtocol", "");
        }

      })();
    </script>
  </body>
</html>
